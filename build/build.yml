trigger:
  branches:
    include:
      - master
      - main
      - refs/tags/*

pr: none

# pr:
#   autoCancel: true
#   branches:
#     include: ['master', 'main']

variables:
  - template: templates/globals.yml

pool:
  vmImage: 'ubuntu-18.04'

jobs:
  - job: vsix
    displayName: VSIX

    steps:
      - template: templates/node.yml
      - template: templates/set-version.yml

      - script: npx vsce package -o vscode-pylance.vsix
        displayName: Package vscode-pylance
        workingDirectory: packages/vscode-pylance

      - publish: packages/vscode-pylance/vscode-pylance.vsix
        artifact: VSIX

  - job: pylance
    displayName: Pylance

    steps:
      - template: templates/node.yml
      - template: templates/set-version.yml

      - script: npm run build
        displayName: Build pylance
        workingDirectory: packages/pylance


      # - publish: packages/pylance/dist
      #   artifact: pylance

  - job: pythia
    displayName: Pythia

    steps:
      - template: templates/node.yml
      - template: templates/set-version.yml

      - script: npm run build
        displayName: Build pythia
        workingDirectory: packages/pylance-pythia

      - publish: packages/pylance-pythia/dist
        artifact: pythia
