trigger:
  branches:
    include:
      - master
      - main
      - refs/tags/*

pr: none

# pr:
#   autoCancel: true
#   branches:
#     include: ['master', 'main']

variables:
  - template: templates/globals.yml

pool:
  vmImage: 'ubuntu-18.04'

jobs:
  - job: vsix
    displayName: VSIX

    steps:
      - template: templates/node.yml
      - template: templates/set-version.yml

      - script: npm run package
        displayName: Package vscode-pylance
        workingDirectory: packages/vscode-pylance

      - script: mv *.vsix vscode-pylance.vsix
        displayName: Rename VSIX
        workingDirectory: packages/pylance

      - publish: packages/vscode-pylance/vscode-pylance.vsix
        artifact: VSIX

  - job: pylance
    displayName: NPM zip

    steps:
      - template: templates/node.yml
      - template: templates/set-version.yml

      - script: npm run pack-zip
        displayName: Package pylance zip
        workingDirectory: packages/pylance

      - script: mv *.zip pylance.zip
        displayName: Rename zip
        workingDirectory: packages/pylance

      - publish: packages/pylance/pylance.zip
        artifact: npm
